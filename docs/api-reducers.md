---
id: api-reducers
title: Reducers
sidebar_label: reducers
---

## Redux Store in bPanel
The accepted convention for reducers and the application state in bPanel is for top level store,
e.g. `node`, `chain`, etc., to be representative of the state of your bcoin node. So if a plugin wants
to retrieve the chain height, or update it based on an event, you know you can access it
from `state.chain.height`. For plugin specific reducers, there is a special `plugins` store you can use.
See `reducePlugins` extension below which also helps avoid naming collisions.

## The API

The plugin API exposes certain parts of the store's reducer. You can target these reducers by exporting one of the decorating functions described on this page (more may be added in the future).

Available extensions:

<AUTOGENERATED_TABLE_OF_CONTENTS>

A description of reducers in redux from the [docs](https://redux.js.org/basics/reducers):

>Reducers specify how the application's state changes in response to actions sent to the store. Remember that actions only describe the fact that something happened, but don't describe how the application's state changes.

So with these extensions, you are indicating how you want the app state to change based on specific actions that have been [dispatched](/docs/api-map-state-dispatch.html) to the store. Each individual reducer extension is targeting a specific part of the state.

To get information about the shape of the part of the state you would like to interact with, we recommend using the [Redux DevTools Extension](https://github.com/zalmoxisus/redux-devtools-extension).


## Available Reducers:
### `reducePlugins`
This is a "catch-all" reducer. Its initial state with no plugins is simply an empty object and
its only built-in action type is `ADD_PLUGIN`. This reducer lets you add a new plugin
store when dispatched, keyed to an id passed inside the payload. This is not strictly necessary
to add to the plugins store, but it's useful if you want bPanel to check for conflicts (it won't
allow for two plugin stores with the same id). Doing it on your own, there is no guarantee that
your reducer won't overwrite the state from another plugin, so adding a unique prefix
as identifier to your store id, regardless is a good idea and the responsibility of each
plugin developer.

(We plan to add a more robust custom reducer system in the future)

The first step is to setup your initial state by catching the `APP_LOADED` action
in your middleware, and dispatching `ADD_PLUGIN` with the unique id and the rest of your state
in the payload (this step isn't necessary with other reducers since their state is already
initialized).
```javascript
// index.js
export const middleware = store => next => action {
  const { dispatch } = store;
  if (action.type === 'APP_LOADED') {
    dispatch({
      type: 'ADD_PLUGIN',
      payload: {
        id: 'myplugin_store1',
        arrayToStore: [],
        children: {},
        otherProps: {}
      }
    });
  }
  // make sure to call next so other
  // plugins can see app has loaded
  next(action);
};
```

Then just extend the reducer like you would for any other:

```javascript
// index.js
export const reducePlugins = (state, action) => {
  const newState = { ...state };
  switch (action.type) {
    case 'ADD_MY_UNIQUE_ARRAY': {
      const { pluginStore } = newState['myplugin_store1'];
      const arr = [...pluginStore.arrayToStore];
      arr.push('some item');
      newState.arrayToStore = arr;
      return newState;
    }
  }
};

```

### `navStore`
Currently the nav store doesn't support decoration. By dispatching the appropriate
actions however, you can add and remove items from the App's navigation.

#### ADD_SIDE_NAV
To add a new item to the side navigation, simply send a payload with an object
that mirrors the shape of the [`metadata`](/docs/api-metadata.html) object for new plugins.

In addition you will also need to add a unique id. The built in `addSideNav` action creator in bPanel
generates one automatically by taking the first 6 characters of the hash of your object.

##### Properties
| Property       | Required?     | Type        | Details     |
| -------------  | ------------- | --------    | -------     |
| `name`         | yes           | `string`    | Used to identify your plugin. Must follow npm naming rules  |
| `id`         | yes           | `string`      | unique id. This will be added to the link component in the DOM  |
| `displayName`  | no            | `string`    | Will default to `name` if none is provided |
| `pathName`     | yes            | `string`    | If building a view/panel, will be passed to react-router to use as URL of your view|
| `order`        | no            | `int`       | If including in sidebar, useful for ordering nav.<br>If order conflicts between plugins, will sort alphabetically |
| `icon`         | no            | `string`    | Also for sidebar navigation.<br>The name of the font awesome icon to use for your view nav  |
| `sidebar` or `nav`| no            | `bool`      | Default: `false`<br>If true, bPanel will automatically add sidebar navigation for your plugin view  |
| `parent`       | no            | `string`    | Currently no support, but will be used for<br>adding a plugin as child (both in path and in navigation) |

```javascript
// webapp/store/actions/navActions.js

function addSideNav(metadata) {
  assert(metadata.name, 'nav items must include a name');
  const { pathName, name } = metadata;

  // get hash for unique id
  const hash = helpers.getHash(metadata); // utility available in bpanel-utils
  const id = hash.slice(0, 6);
  metadata.pathName = pathName ? pathName : name;
  return {
    type: 'ADD_SIDE_NAV',
    payload: { ...metadata, sidebar: true, id }
  };
}
```

#### REMOVE_SIDE_NAV
To remove a sidebar item, you must pass an object with at least an `id` or `name` property matching
the item you would like to remove.

```javascript
// webapp/store/actions/navActions.js
function removeSideNav(metadata) {
  if (!metadata.id || !metadata.name)
    // eslint-disable-next-line no-console
    console.warn('Must pass an id or name to delete nav item');
  return {
    type: 'REMOVE_SIDE_NAV',
    payload: metadata
  };
};
```

### `reduceChain`
Actions types currently implemented in the chain reducer are:

- `SET_CHAIN_INFO`
- `SET_GENESIS`

Example:
```javascript
// This will return a new `snapshot` property that is
// a snapshot of the current tip hash.
// Pretty useless reducer but gives an idea of functionality
export const reduceChain = (state, action) => {
  const newState = { ...state };
  switch (action.type) {
    case 'MY_CUSTOM_ACTION': {
      const snapshot = action.payload;
      newState.snapshot = snapshot;
      return newState;
    }
  }
};
```

### `reduceNode`
(See [`reduceChain`](#reduceChain))
### `reduceWallets`
(See [`reduceChain`](#reduceChain))